<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>colorandom</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  font-family: sans-serif;
  background-color: #f0f0f0;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}
@media (prefers-color-scheme: dark) {
  body { background-color: #121212; color: #fff; }
}
.controls {
  position: absolute;
  top: 10px;
  z-index: 2000;
  display: flex;
  gap: 10px;
}
button {
  font-size: 16px;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  background-color: #ff8585;
}
.grid {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 10px;
  width: 100%;
  height: 100%;
  margin-top: 70px;
}
.row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  width: 100%;
  transition: all 0.5s;
}
.color-box {
  position: relative;
  border-radius: 8px;
  border: 3px solid #000;
  cursor: pointer;
  transition: transform 0.2s, opacity 0.5s;
  aspect-ratio: 1;
  flex-shrink: 0;
  z-index: 1000;
  opacity: 0;
  transform: translateY(-20px);
}
@media (prefers-color-scheme: dark) {
  .color-box { border-color: #fff; }
}
.minus-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  width: 30px;
  height: 30px;
  border: none;
  border-radius: 6px;
  background: rgba(255,255,255,0.5);
  color: #000;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s, background 0.3s;
}
.color-box:hover .minus-btn { opacity: 1; }
.minus-btn:hover { background: rgba(255,255,255,0.8); }
@media (prefers-color-scheme: dark) {
  .minus-btn { background: rgba(0,0,0,0.5); color: #fff; }
  .minus-btn:hover { background: rgba(0,0,0,0.8); }
}
.color-code {
  position: absolute;
  bottom: 5px;
  right: 5px;
  font-size: 14px;
  background: rgba(255,255,255,0.5);
  color: #000;
  padding: 2px 5px;
  border-radius: 4px;
  opacity: 0;
  transition: opacity 0.3s;
}
.color-box:hover .color-code { opacity: 1; }
@media (prefers-color-scheme: dark) {
  .color-code { background: rgba(0,0,0,0.5); color: #fff; }
}
.lock-btn {
  position: absolute;
  top: 5px;
  left: 5px;
  width: 24px;
  height: 24px;
  border: none;
  border-radius: 4px;
  background: rgba(255,255,255,0.5);
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  transition: all 0.3s;
  opacity: 0; /* ‚Üê „Éá„Éï„Ç©„É´„ÉàÈùûË°®Á§∫ */
}
.color-box:hover .lock-btn { opacity: 1; } /* ‚Üê „Éõ„Éê„ÉºÊôÇ„Å†„ÅëË°®Á§∫ */
.locked { font-weight: bold; }
@media (prefers-color-scheme: dark) {
  .lock-btn { background: rgba(0,0,0,0.5); color: #fff; }
}
</style>
</head>
<body>

<div class="controls" style="right:10px; top:10px; position:absolute;">
  <button id="deleteAllBtn">Delete All</button>
</div>
<div class="controls" style="left:10px; top:10px; position:absolute;">
  <button id="addAllBtn">Add All</button>
</div>
<div class="controls">
  <button id="addBtn">Ôºã</button>
  <button id="pickBtn">Pick</button>
</div>

<div class="grid" id="grid"></div>

<script>
const grid = document.getElementById('grid');
const addBtn = document.getElementById('addBtn');
const pickBtn = document.getElementById('pickBtn');
const deleteAllBtn = document.getElementById('deleteAllBtn');
const addAllBtn = document.getElementById('addAllBtn');
const MAX_BOXES = 8;
let boxes = [];

function getRandomColor() {
  const r=Math.floor(Math.random()*256);
  const g=Math.floor(Math.random()*256);
  const b=Math.floor(Math.random()*256);
  const hex = `#${((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1).toUpperCase()}`;
  return {r,g,b,hex};
}

function createBox(color=null){
  if(boxes.length >= MAX_BOXES) return;

  const box = document.createElement('div');
  box.className = 'color-box';
  box.dataset.locked = 'false';
  if(color) box.style.backgroundColor = color.hex;

  // √ó„Éú„Çø„É≥
  const minusBtn = document.createElement('button');
  minusBtn.className = 'minus-btn';
  minusBtn.textContent = '√ó';
  minusBtn.addEventListener('click', e=>{
    e.stopPropagation();
    box.style.opacity = '0';
    box.style.transform = 'translateY(20px)';
    setTimeout(()=>{
      boxes = boxes.filter(b=>b!==box);
      renderBoxes();
    },500);
  });
  box.appendChild(minusBtn);

  // „Ç´„É©„Éº„Ç≥„Éº„Éâ
  const colorSpan = document.createElement('span');
  colorSpan.className = 'color-code';
  box.appendChild(colorSpan);
  if(color) colorSpan.textContent = color.hex;

  // Èçµ„Éú„Çø„É≥
  const lockBtn = document.createElement('button');
  lockBtn.className = 'lock-btn';
  lockBtn.textContent = 'üîì';
  lockBtn.addEventListener('click', e=>{
    e.stopPropagation();
    if(box.dataset.locked==='false'){
      box.dataset.locked='true';
      lockBtn.textContent='üîí';
    }else{
      box.dataset.locked='false';
      lockBtn.textContent='üîì';
    }
  });
  box.appendChild(lockBtn);

  // „ÇØ„É™„ÉÉ„ÇØ„ÅßColordic„É™„É≥„ÇØ
  box.addEventListener('click', ()=>{
    const hex = box.querySelector('.color-code').textContent.replace('#','');
    if(hex) window.open(`https://www.colordic.org/colorsample/${hex}/`, '_blank');
  });

  // „Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„ÉóÂÖ•„ÇåÊõø„Åà
  box.draggable = true;
  box.addEventListener('dragstart', e=>{
    e.dataTransfer.setData('text/plain', boxes.indexOf(box));
    box.style.opacity = '0.5';
  });
  box.addEventListener('dragend', e=>{
    box.style.opacity = '1';
    boxes.forEach(b=>b.style.transform='translateY(0) scale(1)');
  });
  box.addEventListener('dragover', e=>{
    e.preventDefault();
    e.currentTarget.style.transform='scale(1.1)';
  });
  box.addEventListener('dragleave', e=>{
    e.currentTarget.style.transform='translateY(0) scale(1)';
  });
  box.addEventListener('drop', e=>{
    e.preventDefault();
    e.currentTarget.style.transform='translateY(0) scale(1)';
    const fromIndex=parseInt(e.dataTransfer.getData('text/plain'));
    const toIndex=boxes.indexOf(box);
    if(fromIndex===toIndex) return;
    [boxes[fromIndex], boxes[toIndex]] = [boxes[toIndex], boxes[fromIndex]];
    renderBoxes();
  });

  boxes.push(box);
  renderBoxes();
  setTimeout(()=>{ box.style.opacity='1'; box.style.transform='translateY(0)'; },50);
}

function renderBoxes(){
  grid.innerHTML='';
  const rows=[];
  let row;
  boxes.forEach((box,i)=>{
    if(i%4===0){ row=document.createElement('div'); row.className='row'; rows.push(row); }
    row.appendChild(box);
  });
  rows.forEach(r=>grid.appendChild(r));
  resizeBoxes();
}

function resizeBoxes(){
  const rowElems=Array.from(document.querySelectorAll('.row'));
  const rowCount=rowElems.length;
  if(rowCount===0) return;
  rowElems.forEach(row=>{
    const count=row.children.length;
    let boxSize=Math.min(
      (window.innerWidth-10*(count+1))/Math.min(count,4),
      (window.innerHeight-10*(rowCount+1)-70)/rowCount
    );
    Array.from(row.children).forEach(box=>{
      box.style.width=box.style.height=boxSize+'px';
      box.style.transition='all 0.5s';
    });
  });
}

addBtn.addEventListener('click', ()=>createBox(getRandomColor()));
pickBtn.addEventListener('click', ()=>{
  boxes.forEach(box=>{
    if(box.dataset.locked==='false'){ // üîí„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Å™„Åë„Çå„Å∞Â§âÊõ¥
      const color=getRandomColor();
      box.style.backgroundColor=color.hex;
      box.querySelector('.color-code').textContent=color.hex;
    }
  });
});

// Delete All
deleteAllBtn.addEventListener('click', ()=>{
  boxes.forEach(box=>{
    if(box.dataset.locked==='false'){
      box.style.opacity='0';
      box.style.transform='translateY(20px)';
    }
  });
  setTimeout(()=>{
    boxes = boxes.filter(box=>box.dataset.locked==='true');
    renderBoxes();
  },500);
});

// Add All
addAllBtn.addEventListener('click', ()=>{
  while(boxes.length<MAX_BOXES){
    createBox(getRandomColor());
  }
});

createBox(getRandomColor());
window.addEventListener('resize', resizeBoxes);
</script>

</body>
</html>
