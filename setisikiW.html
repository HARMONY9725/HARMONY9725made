<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>setisikiW</title>
<meta charset="UTF-8">
<style>
body {
    font-family: sans-serif;
    transform: scaleX(-1);
    direction: rtl;
    margin: 0;
    padding: 20px;
    background: #fff;
    color: #000;
}
#searchBar {
    width: 100%;
    font-size: 18px;
    padding: 10px;
    margin-bottom: 20px;
    transform: scaleX(-1);
}
#content {
    max-width: 1000px;
    margin: auto;
}
img, table, pre {
    transform: scaleX(-1);
    max-width: 100%;
    height: auto;
}
table {
    border-collapse: collapse;
    width: 100%;
}
table, th, td {
    border: 1px solid #aaa;
}
th, td {
    padding: 4px 8px;
}
a {
    color: blue;
    cursor: pointer;
}
h1,h2,h3,h4,h5,h6 {
    border-bottom: 1px solid #ccc;
    padding-bottom: 4px;
    margin-top: 20px;
}
</style>
</head>
<body>
<input id="searchBar" type="text" placeholder="Wikipedia検索" onkeydown="if(event.key==='Enter'){searchWiki()}">
<div id="content">ここに記事が表示されます</div>
<script>
async function searchWiki() {
    const query = document.getElementById('searchBar').value;
    if(!query) return;
    const searchUrl = `https://ja.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
    try {
        const searchRes = await fetch(searchUrl);
        const searchData = await searchRes.json();
        if(!searchData.query.search.length){
            document.getElementById('content').innerHTML = '見つかりませんでした';
            return;
        }
        const title = searchData.query.search[0].title;
        loadPage(title);
    } catch(err){
        document.getElementById('content').innerHTML = '検索中にエラーが発生しました';
    }
}
async function loadPage(title){
    const pageUrl = `https://ja.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(title)}&format=json&origin=*`;
    try {
        const pageRes = await fetch(pageUrl);
        const pageData = await pageRes.json();
        const html = pageData.parse.text['*'];
        document.getElementById('content').innerHTML = html;
        document.querySelectorAll('#content a').forEach(a => {
            a.onclick = e => {
                e.preventDefault();
                const href = a.getAttribute('href');
                if(!href.startsWith('/wiki/')) return;
                const newTitle = decodeURIComponent(href.replace('/wiki/', ''));
                document.getElementById('searchBar').value = newTitle;
                loadPage(newTitle);
            }
        });
        document.querySelectorAll('#content img, #content table, #content pre').forEach(el => {
            el.style.transform = 'scaleX(-1)';
        });
    } catch(err){
        document.getElementById('content').innerHTML = 'ページ読み込み中にエラーが発生しました';
    }
}
</script>
</body>
</html>
