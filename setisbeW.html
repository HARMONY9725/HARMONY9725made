<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>逆順検索サイト（日本語対応）</title>
<style>
  body { font-family:sans-serif; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; background:#f5f5f5; min-height:100vh;}
  .search-container { margin-top:50px; display:flex; flex-direction:column; align-items:center;}
  input[type="text"] { width:300px; padding:10px; font-size:18px; text-align:left;}
  button { margin-top:10px; padding:10px 20px; font-size:16px; cursor:pointer;}
  .results { margin-top:40px; width:80%; max-width:800px;}
  .result-item { margin-bottom:15px; padding:10px; background:white; border-radius:6px; box-shadow:0 0 4px rgba(0,0,0,0.2);}
  .result-item a { text-decoration:none; color:#0073e6;}
</style>
</head>
<body>

<div class="search-container">
  <input type="text" id="searchBox" placeholder="検索ワードを入力">
  <button id="searchBtn">検索</button>
</div>

<div class="results" id="results"></div>

<script>
// サンプル検索データ（日本語対応）
const sampleData = [
  {title:"HTMLチュートリアル", url:"#sample1"},
  {title:"CSSガイド", url:"#sample2"},
  {title:"JavaScript入門", url:"#sample3"},
  {title:"Webデザイン例", url:"#sample4"},
  {title:"フロントエンド技術", url:"#sample5"}
];

const searchBox = document.getElementById('searchBox');
let composing = false; // IME入力中フラグ

// IME開始
searchBox.addEventListener('compositionstart', ()=>{ composing = true; });
// IME終了
searchBox.addEventListener('compositionend', (e)=>{
  composing = false;
  reverseInput();
});

// 入力時
searchBox.addEventListener('input', ()=>{
  if(!composing){
    reverseInput();
  }
});

function reverseInput(){
  const val = searchBox.value;
  const reversed = [...val].reverse().join(''); // 日本語対応
  searchBox.value = reversed;
}

// 検索実行
const searchBtn = document.getElementById('searchBtn');
const resultsDiv = document.getElementById('results');
searchBtn.addEventListener('click', ()=>{
  resultsDiv.innerHTML='';
  const reversedData = [...sampleData].reverse();
  reversedData.forEach(item=>{
    const div = document.createElement('div');
    div.className='result-item';
    const a = document.createElement('a');
    a.href=item.url;
    a.textContent=[...item.title].reverse().join(''); // 日本語逆順
    a.addEventListener('click', e=>{
      e.preventDefault();
      openReversedPage(item.title);
    });
    div.appendChild(a);
    resultsDiv.appendChild(div);
  });
});

// クリックで反転ページ
function openReversedPage(title){
  const newWin = window.open();
  newWin.document.write(`
    <html>
    <head>
      <title>${title}</title>
      <style>
        body { transform: rotateY(180deg); font-family:sans-serif; padding:20px;}
      </style>
    </head>
    <body>
      <h1>${[...title].reverse().join('')}</h1>
      <p>ここは逆順表示ページです。文字もすべて逆です。</p>
      <a href="#" onclick="window.close()">閉じる</a>
    </body>
    </html>
  `);
}
</script>

</body>
</html>
